<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<factura id="comprobante" version="1.1.0">
    <infoTributaria>
        <ambiente>{{ ambiente }}</ambiente>
        <tipoEmision>{{ tipo_emision }}</tipoEmision>
        <razonSocial>{{ razon_social }}</razonSocial>
        {% if nombre_comercial %}<nombreComercial>{{ nombre_comercial }}</nombreComercial>{% endif %}
        <ruc>{{ ruc }}</ruc>
        <claveAcceso>{{ clave_acceso }}</claveAcceso>
        <codDoc>{{ cod_doc }}</codDoc>
        <estab>{{ establecimiento }}</estab>
        <ptoEmi>{{ punto_emision }}</ptoEmi>
        <secuencial>{{ secuencial }}</secuencial>
        <dirMatriz>{{ direccion_matriz }}</dirMatriz>
    </infoTributaria>
    <infoFactura>
        <fechaEmision>{{ fecha_emision }}</fechaEmision>
        {% if direccion_establecimiento %}<dirEstablecimiento>{{ direccion_establecimiento }}</dirEstablecimiento>{% endif %}
        {% if contribuyente_especial %}<contribuyenteEspecial>{{ contribuyente_especial }}</contribuyenteEspecial>{% endif %}
        <obligadoContabilidad>{% if obligado_contabilidad %}SI{% else %}NO{% endif %}</obligadoContabilidad>
        <tipoIdentificacionComprador>{{ "{0:02}.format(tipo_identificacion_comprador) }}</tipoIdentificacionComprador>
        <razonSocialComprador>{{ razon_social_comprador }}</razonSocialComprador>
        <identificacionComprador>{{ identificacion_comprador }}</identificacionComprador>
        <totalSinImpuestos>{{ "{0:.2f}".format(total_sin_impuestos) }}</totalSinImpuestos>
        <totalDescuento>{{ "{0:.2f}".format(total_descuento) }}</totalDescuento>
        <totalConImpuestos>
            {% for impuesto in impuestos %}
            <totalImpuesto>
                <codigo>{{ impuesto['codigo'] }}</codigo>
                <codigoPorcentaje>{{ impuesto['porcentaje'] }}</codigoPorcentaje>
				<descuentoAdicional>{{ impuesto['descuento_adicional'] }}</descuentoAdicional>
                <baseImponible>{{ "{0:.2f}".format(impuesto['base_imponible']) }}</baseImponible>
                <valor>{{ "{0:.2f}".format(impuesto['valor']) }}</valor>
            </totalImpuesto>
            {% endfor %}
        </totalConImpuestos>
        <propina>{{ "{0:.2f}".format(propina) }}</propina>
        <importeTotal>{{ "{0:.2f}".format(importe_total) }}</importeTotal>
        <moneda>{{ moneda }}</moneda>
    </infoFactura>
    <detalles>
        {% for detalle in detalles %}
        <detalle>
            {% if detalle.get('codigo_principal') %}<codigoPrincipal>{{ detalle['codigo_principal'] }}</codigoPrincipal>{% endif %}
            {% if detalle.get('codigo_auxiliar') %}<codigoAuxiliar>{{ detalle['codigo_auxiliar'] }}</codigoAuxiliar>{% endif %}
            <descripcion>{{ detalle['descripcion'] }}</descripcion>
            {% if detalle.get('unidad_medida') %}<unidadMedida>{{ detalle['unidad_medida'] }}</unidadMedida>{% endif %}
            <cantidad>{{ "{0:.6f}".format(detalle['cantidad']) }}</cantidad>
            <precioUnitario>{{ "{0:.6f}".format(detalle['precio_unitario']) }}</precioUnitario>
            <descuento>{{ "{0:.2f}".format(detalle['descuento']) }}</descuento>
            <precioTotalSinImpuesto>{{ "{0:.2f}".format(detalle['precio_total_sin_impuesto']) }}</precioTotalSinImpuesto>
            <impuestos>
                {% for impuesto in detalle['impuestos'] %}
                <impuesto>
                    <codigo>{{ impuesto['codigo'] }}</codigo>
                    <codigoPorcentaje>{{ impuesto['codigo_porcentaje'] }}</codigoPorcentaje>
                    <tarifa>{{ "{0:.2f}".format(impuesto['tarifa']) }}</tarifa>
                    <baseImponible>{{ "{0:.2f}".format(impuesto['base_imponible']) }}</baseImponible>
                    <valor>{{ "{0:.2f}".format(impuesto['valor']) }}</valor>
                </impuesto>
                {% endfor %}
            </impuestos>
        </detalle>
        {% endfor %}
    </detalles>
	<retenciones>
        {% for retencion in retenciones %}
        <retencion>
            <codigo>{{ retencion['codigo'] }}</codigo>
            <codigoPorcentaje>{{ retencion['codigo_porcentaje'] }}</codigoPorcentaje>
            <tarifa>{{ "{0:.2f}".format(retencion['tarifa']) }}</tarifa>	    
            <valor>{{ "{0:.2f}".format(retencion['valor']) }}</valor>
        </retencion>
        {% endfor %}
    </retenciones>
    {% if info_adicional %}
    <infoAdicional>
        {% for k,v in info_adicional %}
        <campoAdicional nombre="{{ k }}">{{ v }}</campoAdicional>
        {% endfor %}
    </infoAdicional>
    {% endif %}
</factura>
